<?xml version="1.0" encoding="UTF-8"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>Hieu's blog</title>
    <description>My blog about Linux, Database, Infrastructure, some mathematics, and mindset.</description>
    <link>https://blog.tracelog.in/</link>
    <atom:link href="https://blog.tracelog.in/feed.xml" rel="self" type="application/rss+xml"/>
    <pubDate>Wed, 18 Sep 2019 22:32:17 +0700</pubDate>
    <lastBuildDate>Wed, 18 Sep 2019 22:32:17 +0700</lastBuildDate>
    <generator>Jekyll v3.5.1</generator>
    
      <item>
        <title>Wildcardfuck</title>
        <description>&lt;p&gt;&lt;img src=&quot;/assets/img/asterisk-de.jpg&quot; alt=&quot;img&quot; title=&quot;Wildcardfuck&quot; /&gt;&lt;/p&gt;

&lt;!--description--&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/asterisk-ch.jpg&quot; alt=&quot;img&quot; title=&quot;Wildcardfuck&quot; /&gt;
&lt;img src=&quot;/assets/img/asterisk-at.jpg&quot; alt=&quot;img&quot; title=&quot;Wildcardfuck&quot; /&gt;&lt;/p&gt;

&lt;h2 id=&quot;root-cause&quot;&gt;Root cause&lt;/h2&gt;

&lt;ul&gt;
  &lt;li&gt;There is no fucking rootcause in these cases.&lt;/li&gt;
  &lt;li&gt;It’s lack of knowledge of the guy who did these configurations.&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;You’re assuming that you do it right and you know it clearly&lt;/strong&gt;, &lt;strong&gt;but you never check&lt;/strong&gt; or &lt;strong&gt;learn and understand&lt;/strong&gt; it in the right way.&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;knowledge-base&quot;&gt;Knowledge base&lt;/h2&gt;

&lt;ul&gt;
  &lt;li&gt;
    &lt;p&gt;Character &lt;strong&gt;*&lt;/strong&gt;  is &lt;strong&gt;Asterisk&lt;/strong&gt;. A wildcard DNS record is a record in a DNS zone that will match requests for non-existent domain names. A wildcard DNS record is specified by using a &lt;strong&gt;*&lt;/strong&gt; as the leftmost label (part) of a domain name, e.g. &lt;code class=&quot;highlighter-rouge&quot;&gt;*.example.com&lt;/code&gt;.&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;Wildcards in the DNS are &lt;strong&gt;much more limited&lt;/strong&gt; than other wildcard characters used in other computer systems. &lt;strong&gt;Asterisks at other places in the domain will not work as a wildcard&lt;/strong&gt;, so neither &lt;code class=&quot;highlighter-rouge&quot;&gt;*abc.example.com&lt;/code&gt; nor &lt;code class=&quot;highlighter-rouge&quot;&gt;abc.*.example.com&lt;/code&gt; work as wildcard DNS records&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;h3 id=&quot;using-an-asterisk--in-aws-route53-hosted-zones-and-records&quot;&gt;Using an Asterisk (*) in AWS Route53 Hosted Zones and Records&lt;/h3&gt;

    &lt;p&gt;You can create hosted zones and records that include &lt;strong&gt;*&lt;/strong&gt; in the name.&lt;/p&gt;

    &lt;p&gt;&lt;strong&gt;1. Hosted Zones&lt;/strong&gt;&lt;/p&gt;
    &lt;ul&gt;
      &lt;li&gt;You can’t include an &lt;strong&gt;*&lt;/strong&gt; in the leftmost label in a domain name. For example, &lt;code class=&quot;highlighter-rouge&quot;&gt;*.example.com&lt;/code&gt; is not allowed.&lt;/li&gt;
      &lt;li&gt;If you include &lt;strong&gt;*&lt;/strong&gt; in other positions, DNS treats it as an &lt;strong&gt;*&lt;/strong&gt; character (&lt;code class=&quot;highlighter-rouge&quot;&gt;ASCII 42&lt;/code&gt;), not as a wildcard.&lt;/li&gt;
    &lt;/ul&gt;

    &lt;p&gt;&lt;strong&gt;2. Records&lt;/strong&gt;&lt;/p&gt;

    &lt;p&gt;DNS treats the &lt;strong&gt;*&lt;/strong&gt; character either as a wildcard or as the &lt;strong&gt;*&lt;/strong&gt; character (&lt;code class=&quot;highlighter-rouge&quot;&gt;ASCII 42&lt;/code&gt;), depending on where it appears in the name. Note the following restrictions on using &lt;strong&gt;*&lt;/strong&gt; as a wildcard in the name of a record:&lt;/p&gt;
    &lt;ul&gt;
      &lt;li&gt;The &lt;strong&gt;*&lt;/strong&gt; must replace the leftmost label in a domain name, for example, &lt;code class=&quot;highlighter-rouge&quot;&gt;*.example.com&lt;/code&gt; or &lt;code class=&quot;highlighter-rouge&quot;&gt;*.acme.example.com&lt;/code&gt;. If you include &lt;strong&gt;*&lt;/strong&gt; in any other position, such as &lt;code class=&quot;highlighter-rouge&quot;&gt;prod.*.example.com&lt;/code&gt;, DNS treats it as an &lt;strong&gt;*&lt;/strong&gt; character (&lt;code class=&quot;highlighter-rouge&quot;&gt;ASCII 42&lt;/code&gt;), not as a wildcard.&lt;/li&gt;
      &lt;li&gt;The &lt;strong&gt;*&lt;/strong&gt; must replace the entire label. For example, you can’t specify &lt;code class=&quot;highlighter-rouge&quot;&gt;*prod.example.com&lt;/code&gt; or &lt;code class=&quot;highlighter-rouge&quot;&gt;prod*.example.com&lt;/code&gt;.&lt;/li&gt;
      &lt;li&gt;Specific domain names take precedence. For example, if you create records for &lt;code class=&quot;highlighter-rouge&quot;&gt;*.example.com&lt;/code&gt; and &lt;code class=&quot;highlighter-rouge&quot;&gt;acme.example.com&lt;/code&gt;, Route 53 always responds to DNS queries for &lt;code class=&quot;highlighter-rouge&quot;&gt;acme.example.com&lt;/code&gt; with the values in the &lt;code class=&quot;highlighter-rouge&quot;&gt;acme.example.com&lt;/code&gt; record.&lt;/li&gt;
      &lt;li&gt;The &lt;strong&gt;*&lt;/strong&gt; applies to DNS queries for the subdomain level that includes the asterisk, and all the subdomains of that subdomain. For example, if you create a record named &lt;code class=&quot;highlighter-rouge&quot;&gt;*.example.com&lt;/code&gt;, Route 53 uses the values in that record to respond to DNS queries for &lt;code class=&quot;highlighter-rouge&quot;&gt;zenith.example.com&lt;/code&gt;, &lt;code class=&quot;highlighter-rouge&quot;&gt;acme.zenith.example.com&lt;/code&gt;, and &lt;code class=&quot;highlighter-rouge&quot;&gt;pinnacle.acme.zenith.example.com&lt;/code&gt; (if there are no records that have those names).&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;references&quot;&gt;References&lt;/h2&gt;

&lt;ol&gt;
  &lt;li&gt;&lt;a href=&quot;https://en.wikipedia.org/wiki/Wildcard_DNS_record&quot;&gt;https://en.wikipedia.org/wiki/Wildcard_DNS_record&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://tools.ietf.org/html/rfc4592#page-6&quot;&gt;https://tools.ietf.org/html/rfc4592#page-6&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://docs.aws.amazon.com/Route53/latest/DeveloperGuide/DomainNameFormat.html#domain-name-format-asterisk&quot;&gt;https://docs.aws.amazon.com/Route53/latest/DeveloperGuide/DomainNameFormat.html#domain-name-format-asterisk&lt;/a&gt;&lt;/li&gt;
&lt;/ol&gt;

</description>
        <pubDate>Wed, 18 Sep 2019 00:00:00 +0700</pubDate>
        <link>https://blog.tracelog.in/whatthefuck/2019/09/18/Wildcardfuck.html</link>
        <guid isPermaLink="true">https://blog.tracelog.in/whatthefuck/2019/09/18/Wildcardfuck.html</guid>
        
        
        <category>whatthefuck</category>
        
      </item>
    
      <item>
        <title>Mountfuck</title>
        <description>&lt;p&gt;&lt;img src=&quot;/assets/img/wrong-mount-in-es.webp&quot; alt=&quot;img&quot; title=&quot;Entire fucking dir in fuckin /var/lib/elasticsearch&quot; /&gt;&lt;/p&gt;

&lt;!--description--&gt;

&lt;h2 id=&quot;root-cause&quot;&gt;Root cause&lt;/h2&gt;

&lt;p&gt;&lt;a href=&quot;https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/nvme-ebs-volumes.html&quot;&gt;https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/nvme-ebs-volumes.html&lt;/a&gt;&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;EBS uses single-root I/O virtualization (SR-IOV) to provide volume attachments on Nitro-based instances using the NVMe specification. 
These devices rely on standard NVMe drivers on the operating system. 
These drivers typically discover attached devices by scanning the PCI bus during instance boot, and create device nodes based on the order in which the devices respond, not on how the devices are specified in the block device mapping. 
In Linux, NVMe device names follow the pattern /dev/nvme&amp;lt;x&amp;gt;n&amp;lt;y&amp;gt;, where &amp;lt;x&amp;gt; is the enumeration order, and, for EBS, &amp;lt;y&amp;gt; is 1. 
Occasionally, devices can respond to discovery in a different order in subsequent instance starts, which causes the device name to change.
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;So, if we use NVMe disk for some new types of AWS EC2, please note that the device name is nearly randomize after each reboot.
It means if we have 2 NVMe disks on one EC2 vm, so we cannot know which device name delegate to which real disk.&lt;/p&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;/dev/nvme1n1p1
/dev/nvme0n1p1
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;h2 id=&quot;solution&quot;&gt;Solution&lt;/h2&gt;

&lt;p&gt;We must config fstab (permanent mount) based on UUID / label like this&lt;/p&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;LABEL=cloudimg-rootfs  /   ext4  defaults,discard  0 0
UUID=&quot;c46cf311-d31b-41ce-bce5-5d8ad0a6b109&quot; /var/lib/elasticsearch ext4 defaults,nofail  0 2
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;DON’T config based on device name like this fuck&lt;/p&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;LABEL=cloudimg-rootfs	/	 ext4	defaults,discard	0 0
/dev/nvme1n1p1 /var/lib/elasticsearch ext4 defaults,nofail  0 2
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
</description>
        <pubDate>Wed, 18 Sep 2019 00:00:00 +0700</pubDate>
        <link>https://blog.tracelog.in/whatthefuck/2019/09/18/Mountfuck.html</link>
        <guid isPermaLink="true">https://blog.tracelog.in/whatthefuck/2019/09/18/Mountfuck.html</guid>
        
        
        <category>whatthefuck</category>
        
      </item>
    
      <item>
        <title>Jenkinsfuck</title>
        <description>&lt;p&gt;&lt;img src=&quot;/assets/img/jenkins-oops.webp&quot; alt=&quot;img&quot; title=&quot;EatWhatYouKill&quot; /&gt;&lt;/p&gt;

&lt;!--description--&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;Mar 01, 2019 11:19:14 AM org.eclipse.jetty.server.handler.ContextHandler$Context log
WARNING: Error while serving https://ci.tools.xxxxxx.io/job/live-xxxxxx/27/logText/progressiveHtml
java.lang.reflect.InvocationTargetException
    at org.kohsuke.stapler.Function$MethodFunction.invoke(Function.java:347)
    ...
    ...
    at org.eclipse.jetty.io.ChannelEndPoint$2.run(ChannelEndPoint.java:118)
    at org.eclipse.jetty.util.thread.strategy.EatWhatYouKill.runTask(EatWhatYouKill.java:333)
    at org.eclipse.jetty.util.thread.strategy.EatWhatYouKill.doProduce(EatWhatYouKill.java:310)
    at org.eclipse.jetty.util.thread.strategy.EatWhatYouKill.tryProduce(EatWhatYouKill.java:168)
    at org.eclipse.jetty.util.thread.strategy.EatWhatYouKill.run(EatWhatYouKill.java:126)
    at org.eclipse.jetty.util.thread.ReservedThreadExecutor$ReservedThread.run(ReservedThreadExecutor.java:366)
    ...
    ...
Caused by: java.lang.NegativeArraySizeException
    at hudson.console.ConsoleNote.readFrom(ConsoleNote.java:241)
    at hudson.console.ConsoleAnnotationOutputStream.eol(ConsoleAnnotationOutputStream.java:109)
    at hudson.console.LineTransformationOutputStream.eol(LineTransformationOutputStream.java:60)
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;h2 id=&quot;root-cause&quot;&gt;Root cause&lt;/h2&gt;

&lt;p&gt;Details of log: &lt;a href=&quot;/assets/raw/jenkins-NegativeArraySizeException-error.log&quot;&gt;jenkins-NegativeArraySizeException-error.log&lt;/a&gt;&lt;/p&gt;
&lt;div class=&quot;language-java highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;kd&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;NegativeArraySizeException&lt;/span&gt;
&lt;span class=&quot;kd&quot;&gt;extends&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;RuntimeException&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;Thrown if an application tries to create an array with negative size.&lt;/p&gt;

&lt;p&gt;Output of this running job is: too big and spawn too fast &lt;strong&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;rarely&lt;/code&gt;&lt;/strong&gt; that reach &lt;code class=&quot;highlighter-rouge&quot;&gt;NegativeArraySize&lt;/code&gt; during entire log workflow from&lt;/p&gt;
&lt;ul&gt;
  &lt;li&gt;ConsoleNote &amp;gt; ConsoleAnnotationOutputStream &amp;gt; FileLogStorage &amp;gt; ProxyOutputStream&lt;/li&gt;
  &lt;li&gt;to doProgressText and until doProgressiveHtml&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;solution&quot;&gt;Solution&lt;/h2&gt;

&lt;p&gt;EatWhatYouKill&lt;/p&gt;

&lt;p&gt;Don’t panic, just wait, let them come then let them go. Wait until this fucking job DONE. Then issuse will….gone&lt;/p&gt;
</description>
        <pubDate>Wed, 18 Sep 2019 00:00:00 +0700</pubDate>
        <link>https://blog.tracelog.in/whatthefuck/2019/09/18/Jenkinsfuck.html</link>
        <guid isPermaLink="true">https://blog.tracelog.in/whatthefuck/2019/09/18/Jenkinsfuck.html</guid>
        
        
        <category>whatthefuck</category>
        
      </item>
    
      <item>
        <title>Idempotence when extending AWS security group rules in Terraform</title>
        <description>&lt;p&gt;Terraform acts so weird when mixing up between &lt;code class=&quot;highlighter-rouge&quot;&gt;aws_security_group&lt;/code&gt; and &lt;code class=&quot;highlighter-rouge&quot;&gt;aws_security_group_rule&lt;/code&gt; in extending AWS security group rules.&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;Context:&lt;/strong&gt; that leads to not idempotent for each apply (without changing anything in IaC)&lt;/p&gt;
&lt;ul&gt;
  &lt;li&gt;Create one security group using &lt;code class=&quot;highlighter-rouge&quot;&gt;aws_security_group&lt;/code&gt; with some predefined inlines&lt;/li&gt;
  &lt;li&gt;Extending more rules (rows) in that secgroup by using &lt;code class=&quot;highlighter-rouge&quot;&gt;aws_security_group_rule&lt;/code&gt; to add more discrete rules&lt;/li&gt;
  &lt;li&gt;At each time executing &lt;code class=&quot;highlighter-rouge&quot;&gt;terraform plan/apply&lt;/code&gt;, terraform re-creates rules lead to fcked up idempotent of result.&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Sample code at:&lt;/p&gt;
&lt;ul&gt;
  &lt;li&gt;DO NOT USE - &lt;a href=&quot;/assets/raw/aws-secgroup-not-idempotence.tf&quot;&gt;aws-secgroup-not-idempotence.tf&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;BEST PRACTICE - &lt;a href=&quot;/assets/raw/aws-secgroup-best-practice-idempotence.tf&quot;&gt;aws-secgroup-best-practice-idempotence.tf&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;!--description--&gt;

&lt;p&gt;&lt;strong&gt;Table of Contents&lt;/strong&gt;&lt;/p&gt;
&lt;ul id=&quot;markdown-toc&quot;&gt;
  &lt;li&gt;&lt;a href=&quot;#a-knowledge-base&quot; id=&quot;markdown-toc-a-knowledge-base&quot;&gt;A. Knowledge base&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#b-best-practices&quot; id=&quot;markdown-toc-b-best-practices&quot;&gt;B. Best practices&lt;/a&gt;    &lt;ul&gt;
      &lt;li&gt;&lt;a href=&quot;#confident-clear--well-configured&quot; id=&quot;markdown-toc-confident-clear--well-configured&quot;&gt;Confident, clear &amp;amp; well configured&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#extendable-plugable-anywhere-later&quot; id=&quot;markdown-toc-extendable-plugable-anywhere-later&quot;&gt;Extendable, plugable anywhere later&lt;/a&gt;&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#c-issue-links--references&quot; id=&quot;markdown-toc-c-issue-links--references&quot;&gt;C. Issue links &amp;amp; References&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;a-knowledge-base&quot;&gt;A. Knowledge base&lt;/h2&gt;

&lt;p&gt;For defining AWS secgroup in terraform, we have 2 main ways:&lt;/p&gt;
&lt;ul&gt;
  &lt;li&gt;
    &lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;inline&lt;/code&gt; with &lt;code class=&quot;highlighter-rouge&quot;&gt;aws_security_group&lt;/code&gt;&lt;/p&gt;

    &lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# Predefined all rules using inline
resource &quot;aws_security_group&quot; &quot;default&quot; {
  name        = &quot;default&quot;
  vpc_id      = &quot;xxxxx&quot;

  ingress {
    from_port   = 22
    to_port     = 22
    protocol    = &quot;tcp&quot;
    description = &quot;Predefined Whitelist &quot;
    cidr_blocks = &quot;${var.whitelist_ips}&quot;
  }

  egress {
    from_port   = 0
    to_port     = 0
    protocol    = &quot;-1&quot;
    cidr_blocks = [&quot;0.0.0.0/0&quot;]
  }
}
&lt;/code&gt;&lt;/pre&gt;
    &lt;/div&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;or &lt;code class=&quot;highlighter-rouge&quot;&gt;discrete&lt;/code&gt; with &lt;code class=&quot;highlighter-rouge&quot;&gt;aws_security_group_rule&lt;/code&gt;.&lt;/p&gt;

    &lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# Discrete rules
resource &quot;aws_security_group_rule&quot; &quot;extending_default&quot; {
  type              = &quot;ingress&quot;
  from_port         = 22
  to_port           = 22
  protocol          = &quot;tcp&quot;
  cidr_blocks       = [&quot;1.1.1.1/32&quot;]
  security_group_id = &quot;${aws_security_group.default.id}&quot;
  description       = &quot;VPN&quot;
}
&lt;/code&gt;&lt;/pre&gt;
    &lt;/div&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;If we streamline one method when configuring, everything is fine:&lt;/p&gt;
&lt;ul&gt;
  &lt;li&gt;One method using &lt;code class=&quot;highlighter-rouge&quot;&gt;aws_security_group&lt;/code&gt; and all rules are defined as &lt;code class=&quot;highlighter-rouge&quot;&gt;inline&lt;/code&gt; ==&amp;gt;  &lt;strong&gt;PERFECT&lt;/strong&gt; but hard to extended whenever you wanna fetch that security group ID from another place.&lt;/li&gt;
  &lt;li&gt;One method using &lt;code class=&quot;highlighter-rouge&quot;&gt;aws_security_group&lt;/code&gt; without any inline, and use each &lt;code class=&quot;highlighter-rouge&quot;&gt;aws_security_group_rule&lt;/code&gt; for defining rules ==&amp;gt; &lt;strong&gt;PERFECT&lt;/strong&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;If we mixed up by predefined inline in &lt;code class=&quot;highlighter-rouge&quot;&gt;aws_security_group&lt;/code&gt; then continue extending by discrete more rules in &lt;code class=&quot;highlighter-rouge&quot;&gt;aws_security_group_rule&lt;/code&gt; ==&amp;gt; &lt;strong&gt;FCKED UP&lt;/strong&gt;&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;&lt;strong&gt;NOTE on Security Groups and Security Group Rules:&lt;/strong&gt; Terraform currently provides both a standalone Security Group Rule resource (a single &lt;code class=&quot;highlighter-rouge&quot;&gt;ingress&lt;/code&gt; or &lt;code class=&quot;highlighter-rouge&quot;&gt;egress&lt;/code&gt; rule), and a Security Group resource with &lt;code class=&quot;highlighter-rouge&quot;&gt;ingress&lt;/code&gt; and &lt;code class=&quot;highlighter-rouge&quot;&gt;egress&lt;/code&gt; rules &lt;strong&gt;defined in-line&lt;/strong&gt;. At this time you &lt;strong&gt;cannot use&lt;/strong&gt; a Security Group with in-line rules in conjunction with any Security Group Rule resources. Doing so will cause a conflict of rule settings and will overwrite rules.&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;Source:&lt;/strong&gt; &lt;a href=&quot;https://www.terraform.io/docs/providers/aws/r/security_group.html&quot;&gt;terraform&lt;/a&gt;&lt;/p&gt;

&lt;hr /&gt;

&lt;h2 id=&quot;b-best-practices&quot;&gt;B. Best practices&lt;/h2&gt;

&lt;ul&gt;
  &lt;li&gt;
    &lt;h3 id=&quot;confident-clear--well-configured&quot;&gt;Confident, clear &amp;amp; well configured&lt;/h3&gt;

    &lt;p&gt;If we’re confident to say that our secgroup is well defined from the first place in mind, init one time, then use in many place and &lt;strong&gt;no need to changes/extend anymore&lt;/strong&gt; in the future, so go head with configuring entire segroup &amp;amp; rule in &lt;code class=&quot;highlighter-rouge&quot;&gt;aws_security_group&lt;/code&gt; by inline&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;h3 id=&quot;extendable-plugable-anywhere-later&quot;&gt;Extendable, plugable anywhere later&lt;/h3&gt;

    &lt;p&gt;If we’re working on one secgroup which is not well-defined in the first time, need extended and plug in/out rules in another place, go head with configuring core skeletion of secgroup using &lt;code class=&quot;highlighter-rouge&quot;&gt;aws_security_group&lt;/code&gt; without any rules, then plug in rule by rule with &lt;code class=&quot;highlighter-rouge&quot;&gt;aws_security_group_rule&lt;/code&gt;&lt;/p&gt;

    &lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# Create secgroup skeleton without any inline
resource &quot;aws_security_group&quot; &quot;default_http&quot; {
  name        = &quot;default-http&quot;
  vpc_id      = &quot;xxxxx&quot;
}

# Then define rules for this above secgroup
resource &quot;aws_security_group_rule&quot; &quot;default_http_ingress&quot; {
  type             = &quot;ingress&quot;
  from_port        = 80
  to_port          = 80
  protocol         = &quot;tcp&quot;
  description      = &quot;Worldwide&quot;
  cidr_blocks      = [&quot;0.0.0.0/0&quot;]
  security_group_id = aws_security_group.default_http.id
}

resource &quot;aws_security_group_rule&quot; &quot;default_https_ingress&quot; {
  type             = &quot;ingress&quot;
  from_port        = 443
  to_port          = 443
  protocol         = &quot;tcp&quot;
  description      = &quot;Worldwide&quot;
  cidr_blocks      = [&quot;0.0.0.0/0&quot;]
  security_group_id = aws_security_group.default_http.id
}
&lt;/code&gt;&lt;/pre&gt;
    &lt;/div&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;c-issue-links--references&quot;&gt;C. Issue links &amp;amp; References&lt;/h2&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;http://cavaliercoder.com/blog/inline-vs-discrete-security-groups-in-terraform.html&quot;&gt;http://cavaliercoder.com/blog/inline-vs-discrete-security-groups-in-terraform.html&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://github.com/hashicorp/terraform/issues/11011&quot;&gt;https://github.com/hashicorp/terraform/issues/11011&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://github.com/terraform-providers/terraform-provider-aws/issues/742&quot;&gt;https://github.com/terraform-providers/terraform-provider-aws/issues/742&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://github.com/hashicorp/terraform/issues/14124&quot;&gt;https://github.com/hashicorp/terraform/issues/14124&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
</description>
        <pubDate>Tue, 13 Aug 2019 00:00:00 +0700</pubDate>
        <link>https://blog.tracelog.in/technical/2019/08/13/Idempotence-when-extending-AWS-security-group-rules-in-Terraform.html</link>
        <guid isPermaLink="true">https://blog.tracelog.in/technical/2019/08/13/Idempotence-when-extending-AWS-security-group-rules-in-Terraform.html</guid>
        
        
        <category>technical</category>
        
      </item>
    
      <item>
        <title>The art of on-call duty</title>
        <description>&lt;p&gt;Being on-call means working/fixing live issues under high pressure and almost during midnight and/or weekend.&lt;/p&gt;
&lt;ul&gt;
  &lt;li&gt;&lt;strong&gt;Taking strong responsibility&lt;/strong&gt; for what we work, for what we did, for what we build&lt;/li&gt;
  &lt;li&gt;Uptime is an important metric, also critical to the success of our production.&lt;/li&gt;
  &lt;li&gt;If our product is down, &lt;strong&gt;we acutely feel our customer’s pain&lt;/strong&gt;&lt;/li&gt;
  &lt;li&gt;Being on-call duty means we can &lt;strong&gt;learn a lot from it&lt;/strong&gt;, for both technical knowledge &amp;amp; growing mindset.&lt;/li&gt;
  &lt;li&gt;Must get high paid for each on-call duty shift, because of stressful.&lt;/li&gt;
&lt;/ul&gt;

&lt;iframe src=&quot;https://giphy.com/embed/NTur7XlVDUdqM&quot; width=&quot;768&quot; height=&quot;419&quot; frameborder=&quot;0&quot; class=&quot;giphy-embed&quot; allowfullscreen=&quot;&quot;&gt;&lt;/iframe&gt;
&lt;!--description--&gt;

&lt;p&gt;&lt;strong&gt;Table of Contents&lt;/strong&gt;&lt;/p&gt;
&lt;ul id=&quot;markdown-toc&quot;&gt;
  &lt;li&gt;&lt;a href=&quot;#the-art-of-on-call-duty&quot; id=&quot;markdown-toc-the-art-of-on-call-duty&quot;&gt;THE ART OF ON-CALL DUTY&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#standard-flow-for-on-call-duty-life-cycle&quot; id=&quot;markdown-toc-standard-flow-for-on-call-duty-life-cycle&quot;&gt;STANDARD FLOW FOR ON-CALL DUTY LIFE CYCLE&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#root-cause&quot; id=&quot;markdown-toc-root-cause&quot;&gt;ROOT CAUSE&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#reference&quot; id=&quot;markdown-toc-reference&quot;&gt;REFERENCE&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;the-art-of-on-call-duty&quot;&gt;THE ART OF ON-CALL DUTY&lt;/h2&gt;

&lt;p&gt;Important points:&lt;/p&gt;
&lt;ul&gt;
  &lt;li&gt;Keep production services reliable and available&lt;/li&gt;
  &lt;li&gt;Must have one of many dedicated teams of SREs that always take responsibility for the performance and reliability, also must have a &lt;strong&gt;strong background&lt;/strong&gt; of system/infra/network and software development (because maybe need to inspect each line of code)&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;When you know you might get woken up in the middle of the night if there is a problem, you become more careful building infra, implementing components and testing.&lt;/strong&gt;&lt;/li&gt;
  &lt;li&gt;Troubleshooting the system forces you to get a good understanding of &lt;strong&gt;how it all works&lt;/strong&gt;&lt;/li&gt;
  &lt;li&gt;Being on-call means we always facing with these internal issues like:
    &lt;ul&gt;
      &lt;li&gt;troubleshooting tools aren’t as good as they should be&lt;/li&gt;
      &lt;li&gt;false alarms, unreliable alarms&lt;/li&gt;
      &lt;li&gt;logs without useful information&lt;/li&gt;
      &lt;li&gt;have no way to backup/restore&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;=&amp;gt; &lt;strong&gt;Improve our mindset&lt;/strong&gt; for making alerting/monitoring/logging system better during live issues, driving improvements at every part of entire our system&lt;/p&gt;

&lt;h2 id=&quot;standard-flow-for-on-call-duty-life-cycle&quot;&gt;STANDARD FLOW FOR ON-CALL DUTY LIFE CYCLE&lt;/h2&gt;

&lt;ol&gt;
  &lt;li&gt;&lt;strong&gt;Build&lt;/strong&gt;: init monitoring &amp;amp; logging system that help us detect live failures before most customers notice a problem, set up a reliable alerting system (pagerduty) to make sure we can receive alerts immediately&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;Prepare&lt;/strong&gt;: rotating SRE team member by shift to make sure we always have at least one guy to take care production anytime, also covered with always ready machine/LTE/phone&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;Triage&lt;/strong&gt;: acknowledge (ack) on alerts whenever you can, determine the urgency of the problem&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;Fix&lt;/strong&gt;: take whatever actions are necessary in order to resolve the issue immediately and get production back to normal, including implement hotfix or even rollback to the last working version.&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;Report&lt;/strong&gt;: after fixing incident, need to file ticket/report for logging which issues, what we did for solving, file a JIRA ticket to keep a track and push more and more details into this, writing a postmortem (incident postmortem is an excellent framework for learning from incidents and turning problems into progress)&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;Follow-up &amp;amp; Improvement&lt;/strong&gt;: fixed issues &amp;amp; logged into specific tickets do not mean we’re done with that, not yet. We must &lt;strong&gt;take action to follow-up after incident&lt;/strong&gt;, how to &lt;strong&gt;prevent these issues in the future&lt;/strong&gt;, improve sense of alerting, how can we backup/restore/rollback, how to make alarm more &lt;strong&gt;precise, responsive, and sensitive&lt;/strong&gt;. At every step of follow-up/improvement, must write them down to central documentation.&lt;/li&gt;
&lt;/ol&gt;

&lt;h2 id=&quot;root-cause&quot;&gt;ROOT CAUSE&lt;/h2&gt;

&lt;ul&gt;
  &lt;li&gt;If we only fix the symptoms (what we see on the surface), the problem will almost certainly return, and need fixing over, and over again&lt;/li&gt;
  &lt;li&gt;So the Root cause means:
    &lt;ul&gt;
      &lt;li&gt;What has caused the incident?&lt;/li&gt;
      &lt;li&gt;What’s the reason the system failed the way it did?&lt;/li&gt;
      &lt;li&gt;What’s initiating cause that led to an outage or degradation in performance&lt;/li&gt;
      &lt;li&gt;If we know and identify the root cause, action can be taken to fix issues permanently&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;In a technical way, root cause of live issues can be separated into 3 groups&lt;/p&gt;
&lt;ul&gt;
  &lt;li&gt;&lt;strong&gt;Changes in the last deployment&lt;/strong&gt;: changes in codebase, changes in configurations, but not be tested carefully or not aware of hidden failures&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;Exist at scale&lt;/strong&gt;: during high traffic, during unexpected traffic, bottle-neck or facing limitations of some important components&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;3rd party issue&lt;/strong&gt;: hardware failure, provider/ISP failure, unreliable networking, 3rd API issues,…&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;reference&quot;&gt;REFERENCE&lt;/h2&gt;
&lt;ol&gt;
  &lt;li&gt;https://henrikwarne.com/2018/12/03/developer-on-call/&lt;/li&gt;
  &lt;li&gt;https://www.intercom.com/blog/rapid-response-how-we-developed-an-on-call-team-at-intercom/&lt;/li&gt;
  &lt;li&gt;https://response.pagerduty.com/oncall/being_oncall/&lt;/li&gt;
  &lt;li&gt;https://landing.google.com/sre/sre-book/chapters/being-on-call/&lt;/li&gt;
  &lt;li&gt;https://www.atlassian.com/blog/statuspage/incident-postmortem-writing-tips&lt;/li&gt;
&lt;/ol&gt;
</description>
        <pubDate>Sat, 23 Mar 2019 00:00:00 +0700</pubDate>
        <link>https://blog.tracelog.in/mindset/2019/03/23/The-art-of-on-call-duty.html</link>
        <guid isPermaLink="true">https://blog.tracelog.in/mindset/2019/03/23/The-art-of-on-call-duty.html</guid>
        
        
        <category>mindset</category>
        
      </item>
    
      <item>
        <title>Some meaningful thoughts for entire 2018</title>
        <description>&lt;p&gt;This is a post for reminding these learned points, thinkings, ideas, mindsets about how to do and live better in 2018, only for myself. I logged because I scare that I will forget and go wrong or do the same mistake ever and ever again.&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;Time is a &lt;strong&gt;fixed&lt;/strong&gt; and the most important resource, if taking care too much about non-sense things, &lt;strong&gt;will have no time&lt;/strong&gt; for really right and important things in your life.&lt;/li&gt;
  &lt;li&gt;Run, think and &lt;strong&gt;improve continuously whatever&lt;/strong&gt;, even small/big things everyday. Live today in the same state as yesterday does not mean the same, it means &lt;strong&gt;lagging behind others&lt;/strong&gt;.&lt;/li&gt;
  &lt;li&gt;Write down, well documented, or take note on somewhere because of &lt;strong&gt;forgetting process&lt;/strong&gt; in the human brain, but make sure &lt;strong&gt;never forget mindsets&lt;/strong&gt; and &lt;strong&gt;core thinking techniques&lt;/strong&gt; (like critical thinking, SWOT analysis,…). Details can forget, but cores must be in brain, seriously.&lt;/li&gt;
  &lt;li&gt;Must know &lt;strong&gt;why you do what you do?&lt;/strong&gt;&lt;/li&gt;
  &lt;li&gt;Should have private time for yourself (every week), no smartphone, no laptop, no people, just you and think about the past week or doing meditation for training attention and awareness, achieve a mentally clear and emotionally calm state.&lt;/li&gt;
&lt;/ul&gt;

&lt;!--description--&gt;

&lt;h2 id=&quot;there-are-only-2-basic-types-of-action&quot;&gt;There are only 2 basic types of action:&lt;/h2&gt;
&lt;ul&gt;
  &lt;li&gt;One: you can totally control this.&lt;/li&gt;
  &lt;li&gt;Two: you be forced to do regardless of you hate or refuse to do, don’t care, let them come then let them go.&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;I want to note and share about &lt;strong&gt;the first one&lt;/strong&gt;. So you can control actions, think about:&lt;/p&gt;
&lt;ul&gt;
  &lt;li&gt;Making decision for doing the right thing at right time for &lt;strong&gt;gaining highest value&lt;/strong&gt;.&lt;/li&gt;
  &lt;li&gt;Focus on working scoped things during 8hrs working day, only for increasing quality of your company products, &lt;strong&gt;ignore non-sense things&lt;/strong&gt; (including fuckers and dirty ones, &lt;strong&gt;who the fuck cares&lt;/strong&gt;)&lt;/li&gt;
  &lt;li&gt;Do one thing, get it done first (minimum viable), take a rest then get back to work on improvement, check every case, every reason. &lt;strong&gt;DROP OTHERS&lt;/strong&gt;&lt;/li&gt;
  &lt;li&gt;Don’t fucking any care about trash, shitty, fuckers, stupid, nonsense, not related to you. &lt;strong&gt;IGNORE.IGNORE.IGNORE.&lt;/strong&gt; is the key.&lt;/li&gt;
&lt;/ul&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;Time is a fixed and the most important resource,
if taking care too much about non-sense things, 
will have no time for really right and important things in your life.
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;&lt;strong&gt;It’s all about trade-offs and makes the right decisions.&lt;/strong&gt;&lt;/p&gt;
</description>
        <pubDate>Tue, 08 Jan 2019 00:00:00 +0700</pubDate>
        <link>https://blog.tracelog.in/mindset/2019/01/08/Some-meaningful-thoughts-for-entire-2018.html</link>
        <guid isPermaLink="true">https://blog.tracelog.in/mindset/2019/01/08/Some-meaningful-thoughts-for-entire-2018.html</guid>
        
        
        <category>mindset</category>
        
      </item>
    
      <item>
        <title>Critical vulnerability on policykit of systemd</title>
        <description>&lt;p&gt;&lt;strong&gt;[CVE-2018-19788]&lt;/strong&gt;: A flaw was found in PolicyKit (aka &lt;code class=&quot;highlighter-rouge&quot;&gt;polkit 0.115&lt;/code&gt;) that allows a user with a uid greater than &lt;code class=&quot;highlighter-rouge&quot;&gt;INT_MAX&lt;/code&gt; to successfully execute any &lt;code class=&quot;highlighter-rouge&quot;&gt;systemctl&lt;/code&gt; command.&lt;/p&gt;
&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;https://github.com/systemd/systemd/issues/11026&quot;&gt;https://github.com/systemd/systemd/issues/11026&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://github.com/freedesktop/polkit/blob/8c1bc8a/src/programs/pkttyagent.c#L156&quot;&gt;https://github.com/freedesktop/polkit/blob/8c1bc8a/src/programs/pkttyagent.c#L156&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://gitlab.freedesktop.org/polkit/polkit/issues/74&quot;&gt;https://gitlab.freedesktop.org/polkit/polkit/issues/74&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Find out more about CVE-2018-19788 from the &lt;a href=&quot;http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2018-19788&quot;&gt;MITRE CVE&lt;/a&gt; dictionary and &lt;a href=&quot;http://web.nvd.nist.gov/view/vuln/detail?vulnId=CVE-2018-19788&quot;&gt;NIST NVD&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/CVE-2018-19788.webp&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;!--description--&gt;

&lt;h2 id=&quot;demo&quot;&gt;DEMO&lt;/h2&gt;

&lt;div class=&quot;language-shell highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;gp&quot;&gt;root@ahihi:~# &lt;/span&gt;useradd -u 4000000000 wtf
&lt;span class=&quot;gp&quot;&gt;root@ahihi:~# &lt;/span&gt;su - wtf
No directory, logging &lt;span class=&quot;k&quot;&gt;in &lt;/span&gt;with &lt;span class=&quot;nv&quot;&gt;HOME&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;/

&lt;span class=&quot;gp&quot;&gt;$ &lt;/span&gt;whoami
wtf
&lt;span class=&quot;gp&quot;&gt;$ &lt;/span&gt;id
&lt;span class=&quot;nv&quot;&gt;uid&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;4000000000&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;wtf&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;gid&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;1002&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;wtf&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;groups&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;1002&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;wtf&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;

&lt;span class=&quot;gp&quot;&gt;$ &lt;/span&gt;systemctl stop sshd.service

&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;process:22860&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;: GLib-GObject-WARNING &lt;span class=&quot;k&quot;&gt;**&lt;/span&gt;: value &lt;span class=&quot;s2&quot;&gt;&quot;-294967296&quot;&lt;/span&gt; of &lt;span class=&quot;nb&quot;&gt;type&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'gint'&lt;/span&gt; is invalid or out of range &lt;span class=&quot;k&quot;&gt;for &lt;/span&gt;property &lt;span class=&quot;s1&quot;&gt;'uid'&lt;/span&gt; of &lt;span class=&quot;nb&quot;&gt;type&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'gint'&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;**&lt;/span&gt;
ERROR:pkttyagent.c:175:main: assertion failed: &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;polkit_unix_process_get_uid &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;POLKIT_UNIX_PROCESS &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;subject&lt;span class=&quot;o&quot;&gt;))&lt;/span&gt; &amp;gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; 0&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;

&lt;span class=&quot;gp&quot;&gt;root@ahihi:~# &lt;/span&gt;systemctl status sshd.service
...
Dec 05 15:38:39 ahihi systemd[1]: Stopping OpenBSD Secure Shell server...
Dec 05 15:38:39 ahihi systemd[1]: Stopped OpenBSD Secure Shell server.
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

</description>
        <pubDate>Wed, 05 Dec 2018 00:00:00 +0700</pubDate>
        <link>https://blog.tracelog.in/security/2018/12/05/Critial-vulnerability-on-policykit-of-systemd.html</link>
        <guid isPermaLink="true">https://blog.tracelog.in/security/2018/12/05/Critial-vulnerability-on-policykit-of-systemd.html</guid>
        
        
        <category>security</category>
        
      </item>
    
      <item>
        <title>Debian on android shell</title>
        <description>&lt;p&gt;&lt;strong&gt;Goal&lt;/strong&gt;: I had one old Android phone, with broken touching/gesture layer. One day, I found it on a dirty old place.&lt;/p&gt;
&lt;ul&gt;
  &lt;li&gt;I wonder how can I make it better with more usability.&lt;/li&gt;
  &lt;li&gt;How can I make it work exactly as I needed.&lt;/li&gt;
  &lt;li&gt;How can I transform this old phone to a super tiny linux machine with interactive shell?&lt;/li&gt;
&lt;/ul&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;Device: xiaomi Mi4W LTE, android 6.0.1 MMB29M
Specs: Qualcomm MSM8974PRO-AC Quad-core max 2.5GHz, 3.00 GB memory, 16GB disk
Kernel: 3.4.0-gf4b741d-00690-gc8911e
Arch: armv7l
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/android-shell.webp&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;!--description--&gt;

&lt;p&gt;&lt;strong&gt;Table of Contents&lt;/strong&gt;&lt;/p&gt;
&lt;ul id=&quot;markdown-toc&quot;&gt;
  &lt;li&gt;&lt;a href=&quot;#a-knowledge-base&quot; id=&quot;markdown-toc-a-knowledge-base&quot;&gt;A. Knowledge base&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#b-hacking--practicing-zone&quot; id=&quot;markdown-toc-b-hacking--practicing-zone&quot;&gt;B. Hacking / Practicing zone&lt;/a&gt;    &lt;ul&gt;
      &lt;li&gt;&lt;a href=&quot;#1-install-adb-and-fastboot-tools-on-mac&quot; id=&quot;markdown-toc-1-install-adb-and-fastboot-tools-on-mac&quot;&gt;1. Install adb and fastboot tools on mac&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#2-download-then-install-twrp--supersu-on-fastboot&quot; id=&quot;markdown-toc-2-download-then-install-twrp--supersu-on-fastboot&quot;&gt;2. Download then install twrp &amp;amp; supersu on fastboot&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#3-expand-utilities-with-busybox&quot; id=&quot;markdown-toc-3-expand-utilities-with-busybox&quot;&gt;3. Expand utilities with busybox&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#4-config--fix-env-variables-and-configuations&quot; id=&quot;markdown-toc-4-config--fix-env-variables-and-configuations&quot;&gt;4. Config / fix env variables and configuations&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#5-extract-debianimg-from-available-debian-system-not-bsd-os-like-mac&quot; id=&quot;markdown-toc-5-extract-debianimg-from-available-debian-system-not-bsd-os-like-mac&quot;&gt;5. Extract debian.img from available debian system (not BSD os like Mac)&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#6-debootstrapping-debian-into-android-os&quot; id=&quot;markdown-toc-6-debootstrapping-debian-into-android-os&quot;&gt;6. Debootstrapping debian into android os&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#7-complete-debian-os-with-apt-and-networking&quot; id=&quot;markdown-toc-7-complete-debian-os-with-apt-and-networking&quot;&gt;7. Complete debian os with apt and networking&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#8-performance-benchmarking&quot; id=&quot;markdown-toc-8-performance-benchmarking&quot;&gt;8. Performance benchmarking&lt;/a&gt;&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#c-reference&quot; id=&quot;markdown-toc-c-reference&quot;&gt;C. Reference&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;a-knowledge-base&quot;&gt;A. Knowledge base&lt;/h2&gt;

&lt;p&gt;For accessing default android shell, we need &lt;code class=&quot;highlighter-rouge&quot;&gt;adb&lt;/code&gt; tools. For booting operation with custom image, we use &lt;code class=&quot;highlighter-rouge&quot;&gt;fastboot&lt;/code&gt; or &lt;code class=&quot;highlighter-rouge&quot;&gt;adb reboot recovery&lt;/code&gt;.
After accessing, with &lt;code class=&quot;highlighter-rouge&quot;&gt;twrp&lt;/code&gt; and &lt;code class=&quot;highlighter-rouge&quot;&gt;supersu&lt;/code&gt; we can grant &lt;code class=&quot;highlighter-rouge&quot;&gt;root&lt;/code&gt; privileges because we need root permission for doing &lt;code class=&quot;highlighter-rouge&quot;&gt;mount&lt;/code&gt; filesystem and totally control the whole system.&lt;/p&gt;

&lt;p&gt;We also need &lt;code class=&quot;highlighter-rouge&quot;&gt;busybox&lt;/code&gt; for expanding utilities like editing files by &lt;code class=&quot;highlighter-rouge&quot;&gt;vi&lt;/code&gt;, checking network connection, …
It’s done for controlling android via &lt;code class=&quot;highlighter-rouge&quot;&gt;adb shell&lt;/code&gt;, but currently, linux os on android is designed for mobile, apk applications, everyday carry and easy to use for all kinds of users, also it’s not using any kind of package management like &lt;code class=&quot;highlighter-rouge&quot;&gt;apt&lt;/code&gt; or &lt;code class=&quot;highlighter-rouge&quot;&gt;yum&lt;/code&gt;, I nearly can do nothing on current system.&lt;/p&gt;

&lt;p&gt;From devops/sre point of view, all I want is pushing/booting a fully &lt;code class=&quot;highlighter-rouge&quot;&gt;linux&lt;/code&gt; os to my android, that’s I can do more things on this, instead of limited android os.
I decided to use &lt;code class=&quot;highlighter-rouge&quot;&gt;debian stretch&lt;/code&gt; with &lt;code class=&quot;highlighter-rouge&quot;&gt;debootrap&lt;/code&gt; for extract custom image and init debian filesystem via &lt;code class=&quot;highlighter-rouge&quot;&gt;chroot&lt;/code&gt; to current android &lt;code class=&quot;highlighter-rouge&quot;&gt;sdcard&lt;/code&gt; directory.&lt;/p&gt;

&lt;h2 id=&quot;b-hacking--practicing-zone&quot;&gt;B. Hacking / Practicing zone&lt;/h2&gt;

&lt;h3 id=&quot;1-install-adb-and-fastboot-tools-on-mac&quot;&gt;1. Install adb and fastboot tools on mac&lt;/h3&gt;
&lt;div class=&quot;language-shell highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;mac❯❯ brew cask install android-platform-tools

mac❯❯ adb --version
Android Debug Bridge version 1.0.40
Version 4797878
Installed as /usr/local/bin/adb

mac❯❯ fastboot --version
fastboot version 28.0.0-4797878
Installed as /usr/local/bin/fastboot

&lt;span class=&quot;c&quot;&gt;# Connect android to mac via usb &lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# Verify device&lt;/span&gt;

mac❯❯ adb devices -l
List of devices attached
1f703708  device usb:336592896X product:cancro_wc_lte model:MI_4W device:cancro transport_id:13
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;h3 id=&quot;2-download-then-install-twrp--supersu-on-fastboot&quot;&gt;2. Download then install twrp &amp;amp; supersu on fastboot&lt;/h3&gt;
&lt;div class=&quot;language-shell highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;mac❯❯ wget internet.com/SR5-SuperSU-v2.82-SR5-20171001224502.zip ./
mac❯❯ wget internet.com/twrp-3.1.0-0-cancro.img ./
mac❯❯ adb push ./SR5-SuperSU-v2.82-SR5-20171001224502.zip /storage/self/primary/
SR5-SuperSU-v2.82-SR5-20171001224502.zip: 1 file pushed. 5.8 MB/s &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;6882992 bytes &lt;span class=&quot;k&quot;&gt;in &lt;/span&gt;1.127s&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;

mac❯❯ adb reboot bootloader

mac❯❯ fastboot devices
1f703708	fastboot

mac❯❯ fastboot flash recovery ./twrp-3.1.0-0-cancro.img
Sending &lt;span class=&quot;s1&quot;&gt;'recovery'&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;13682 KB&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;                      OKAY &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;  0.464s]
Writing &lt;span class=&quot;s1&quot;&gt;'recovery'&lt;/span&gt;                                 OKAY &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;  0.305s]
Finished. Total &lt;span class=&quot;nb&quot;&gt;time&lt;/span&gt;: 0.772s

mac❯❯ fastboot boot ./twrp-3.1.0-0-cancro.img
Downloading &lt;span class=&quot;s1&quot;&gt;'boot.img'&lt;/span&gt;                             OKAY &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;  0.432s]
booting                                            OKAY &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;  0.119s]
Finished. Total &lt;span class=&quot;nb&quot;&gt;time&lt;/span&gt;: 0.560s

&lt;span class=&quot;c&quot;&gt;# After booted into TWRP&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# Install SR5-SuperSU-v2.82-SR5-20171001224502.zip from TWRP&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# Do it on touch screen, or via twrp commandline&lt;/span&gt;

mac❯❯ adb shell 
android❯❯ twrp install /storage/self/primary/SR5-SuperSU-v2.82-SR5-20171001224502.zip
android❯❯ twrp wipe cache
android❯❯ reboot

&lt;span class=&quot;c&quot;&gt;# Verify root on device&lt;/span&gt;

mac❯❯ adb shell
shell@cancro:/ &lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;su -
root@cancro:/ &lt;span class=&quot;c&quot;&gt;# whoami&lt;/span&gt;
root
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;h3 id=&quot;3-expand-utilities-with-busybox&quot;&gt;3. Expand utilities with busybox&lt;/h3&gt;
&lt;div class=&quot;language-shell highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;mac❯❯ wget https://busybox.net/downloads/binaries/1.28.1-defconfig-multiarch/busybox-armv7l
mac❯❯ adb push busybox-armv7l /data/local/tmp
busybox-armv7l: 1 file pushed. 3.8 MB/s &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;1079156 bytes &lt;span class=&quot;k&quot;&gt;in &lt;/span&gt;0.270s&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;

mac❯❯ adb shell
shell@cancro:/ &lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;su -
root@cancro:/ &lt;span class=&quot;c&quot;&gt;# mkdir /data/busybox&lt;/span&gt;
root@cancro:/ &lt;span class=&quot;c&quot;&gt;# move /data/local/tmp/busybox-armv7l /data/busybox&lt;/span&gt;
root@cancro:/ &lt;span class=&quot;c&quot;&gt;# cd /data/busybox&lt;/span&gt;
root@cancro:/data/busybox &lt;span class=&quot;c&quot;&gt;# ls -l&lt;/span&gt;
-rwxrwxrwx shell    shell     1079156 2018-02-15 20:47 busybox-armv7l
root@cancro:/data/busybox &lt;span class=&quot;c&quot;&gt;# ./busybox-armv7l --install ./&lt;/span&gt;

&lt;span class=&quot;c&quot;&gt;# Use ls of busybox &lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# instead of current ls on android&lt;/span&gt;

root@cancro:/ &lt;span class=&quot;c&quot;&gt;# which ls&lt;/span&gt;
/system/bin/ls

root@cancro:/ &lt;span class=&quot;c&quot;&gt;# export PATH=/data/busybox:$PATH&lt;/span&gt;
root@cancro:/ &lt;span class=&quot;c&quot;&gt;# which ls&lt;/span&gt;
/data/busybox/ls
root@cancro:/ &lt;span class=&quot;c&quot;&gt;# which vi&lt;/span&gt;
/data/busybox/vi
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;h3 id=&quot;4-config--fix-env-variables-and-configuations&quot;&gt;4. Config / fix env variables and configuations&lt;/h3&gt;
&lt;div class=&quot;language-shell highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c&quot;&gt;# Choose one: (for security mount /system back to RO when finished)&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# Mount system RW: mount -o rw,remount /system&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# Mount system RO: mount -o ro,remount /system&lt;/span&gt;

root@cancro:/ &lt;span class=&quot;c&quot;&gt;# mount -o rw,remount /system&lt;/span&gt;
root@cancro:/ &lt;span class=&quot;c&quot;&gt;# vi /system/etc/mkshrc&lt;/span&gt;
...
&lt;span class=&quot;nb&quot;&gt;export &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;PATH&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;/data/busybox:&lt;span class=&quot;nv&quot;&gt;$PATH&lt;/span&gt;
...
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;when facing with su command like this, we need reconfigure su&lt;/p&gt;
&lt;div class=&quot;language-shell highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c&quot;&gt;# Issue with su command&lt;/span&gt;

shell@cancro:/ &lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;su
su: must be suid to work properly

&lt;span class=&quot;c&quot;&gt;# Resolve&lt;/span&gt;

root@cancro:/ &lt;span class=&quot;c&quot;&gt;# cp /su/bin/su /data/busybox/su&lt;/span&gt;
root@cancro:/ &lt;span class=&quot;c&quot;&gt;# ls -lh /su/bin/su&lt;/span&gt;
-rwxr-xr-x    1 0        0          73.6K Sep 11 13:49 /su/bin/su
root@cancro:/ &lt;span class=&quot;c&quot;&gt;# ls -lh /data/busybox/su&lt;/span&gt;
-rwx------    1 0        0          73.6K Sep 11 15:58 /data/busybox/su
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;h3 id=&quot;5-extract-debianimg-from-available-debian-system-not-bsd-os-like-mac&quot;&gt;5. Extract debian.img from available debian system (not BSD os like Mac)&lt;/h3&gt;

&lt;p&gt;Install debootstrap then bootstrapping debian stretch image for armv7l arch&lt;/p&gt;
&lt;div class=&quot;language-shell highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;debian❯❯ apt install -y debootstrap debian-archive-keyring debian-ports-archive-keyring
debian❯❯ mkdir debian-armhf
debian❯❯ &lt;span class=&quot;nb&quot;&gt;cd &lt;/span&gt;debian-armhf/
debian❯❯ dd &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;/dev/zero &lt;span class=&quot;nv&quot;&gt;of&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;debian.img &lt;span class=&quot;nv&quot;&gt;bs&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;1MiB &lt;span class=&quot;nv&quot;&gt;count&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;2000
debian❯❯ mke2fs -F debian.img
debian❯❯ mkdir debian
debian❯❯ mount -o loop debian.img debian
debian❯❯ debootstrap --arch armhf --foreign --verbose stretch debian http://ftp.us.debian.org/debian
debian❯❯ umount debian
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/debootstrap.webp&quot; alt=&quot;large-img&quot; title=&quot;Extract debian filesystem via Debootstrap&quot; /&gt;&lt;/p&gt;

&lt;p&gt;rsync file debian.img from debian system to mac system, then push this img to android&lt;/p&gt;
&lt;div class=&quot;language-shell highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;mac❯❯ adb push debian.img /sdcard/
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;h3 id=&quot;6-debootstrapping-debian-into-android-os&quot;&gt;6. Debootstrapping debian into android os&lt;/h3&gt;
&lt;div class=&quot;language-shell highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;mac❯❯ adb shell

shell@cancro:/ &lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;su -
root@cancro:/ &lt;span class=&quot;c&quot;&gt;# mkdir /sdcard/debian-stretch9&lt;/span&gt;
root@cancro:/ &lt;span class=&quot;c&quot;&gt;# losetup /dev/block/loop99 /sdcard/debian.img&lt;/span&gt;
root@cancro:/ &lt;span class=&quot;c&quot;&gt;# mount /dev/block/loop99 /sdcard/debian-stretch9&lt;/span&gt;
root@cancro:/ &lt;span class=&quot;c&quot;&gt;# chroot /sdcard/debian-stretch9 /bin/bash&lt;/span&gt;

&lt;span class=&quot;nb&quot;&gt;export &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;PATH&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;/usr/bin:/usr/sbin:/bin:&lt;span class=&quot;nv&quot;&gt;$PATH&lt;/span&gt;
&lt;span class=&quot;nb&quot;&gt;export &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;TERM&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;linux
&lt;span class=&quot;nb&quot;&gt;export &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;HOME&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;/root
&lt;span class=&quot;nb&quot;&gt;export &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;USER&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;root
/debootstrap/debootstrap --second-stage

&lt;span class=&quot;nb&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;nameserver 8.8.8.8&quot;&lt;/span&gt; &amp;gt;&amp;gt; /etc/resolv.conf
&lt;span class=&quot;nb&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;127.0.0.1 localhost&quot;&lt;/span&gt; &amp;gt; /etc/hosts
&lt;span class=&quot;nb&quot;&gt;exit

&lt;/span&gt;mac❯❯ adb shell
shell@cancro:/ &lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;su -
root@cancro:/ &lt;span class=&quot;c&quot;&gt;# chroot /sdcard/debian-stretch9 /bin/su - root&lt;/span&gt;
&lt;span class=&quot;gp&quot;&gt;root@localhost:~# &lt;/span&gt;whoami &lt;span class=&quot;c&quot;&gt;#should be root&lt;/span&gt;
&lt;span class=&quot;gp&quot;&gt;root@localhost:~# &lt;/span&gt;cat /etc/debian_version &lt;span class=&quot;c&quot;&gt;#9.5&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;h3 id=&quot;7-complete-debian-os-with-apt-and-networking&quot;&gt;7. Complete debian os with apt and networking&lt;/h3&gt;
&lt;p&gt;From the first time, I cannot use &lt;code class=&quot;highlighter-rouge&quot;&gt;ping&lt;/code&gt; or &lt;code class=&quot;highlighter-rouge&quot;&gt;apt&lt;/code&gt;, because Android uses a special Kernel patch that’s activated with &lt;code class=&quot;highlighter-rouge&quot;&gt;CONFIG_ANDROID_PARANOID_NETWORK&lt;/code&gt;. 
For adding specific groups, this patch allows network access to system users that belong to certain special groups with hardcoded IDs.&lt;/p&gt;
&lt;div class=&quot;language-shell highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;mac❯❯ adb shell
shell@cancro:/ &lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;su -
root@cancro:/ &lt;span class=&quot;c&quot;&gt;# chroot /sdcard/debian-stretch9/ /bin/su - root&lt;/span&gt;

&lt;span class=&quot;gp&quot;&gt;root@localhost:~# &lt;/span&gt;groupadd -g 3001 aid_bt
&lt;span class=&quot;gp&quot;&gt;root@localhost:~# &lt;/span&gt;groupadd -g 3002 aid_bt_net
&lt;span class=&quot;gp&quot;&gt;root@localhost:~# &lt;/span&gt;groupadd -g 3003 aid_inet
&lt;span class=&quot;gp&quot;&gt;root@localhost:~# &lt;/span&gt;groupadd -g 3004 aid_net_raw
&lt;span class=&quot;gp&quot;&gt;root@localhost:~# &lt;/span&gt;groupadd -g 3005 aid_admin
&lt;span class=&quot;gp&quot;&gt;root@localhost:~# &lt;/span&gt;usermod -a -G aid_bt,aid_bt_net,aid_inet,aid_net_raw,aid_admin root
&lt;span class=&quot;nb&quot;&gt;exit&lt;/span&gt; - relogin

&lt;span class=&quot;gp&quot;&gt;root@localhost:~# &lt;/span&gt;grep -E &lt;span class=&quot;s2&quot;&gt;&quot;_apt&quot;&lt;/span&gt; /etc/passwd
_apt:x:104:65534::/nonexistent:/bin/false

&lt;span class=&quot;gp&quot;&gt;root@localhost:~# &lt;/span&gt;usermod -g 3003 _apt
&lt;span class=&quot;gp&quot;&gt;root@localhost:~# &lt;/span&gt;grep -E &lt;span class=&quot;s2&quot;&gt;&quot;_apt&quot;&lt;/span&gt; /etc/passwd
_apt:x:104:3003::/nonexistent:/bin/false

&lt;span class=&quot;gp&quot;&gt;root@localhost:~# &lt;/span&gt;apt update
Ign:1 http://ftp.de.debian.org/pub/debian stable InRelease
Get:2 http://ftp.de.debian.org/pub/debian stable Release &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;118 kB]
...
Fetched 12.7 MB &lt;span class=&quot;k&quot;&gt;in &lt;/span&gt;36s &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;351 kB/s&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
Reading package lists... Done
Building dependency tree... Done
All packages are up to date.
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;h3 id=&quot;8-performance-benchmarking&quot;&gt;8. Performance benchmarking&lt;/h3&gt;
&lt;p&gt;…to be continue&lt;/p&gt;

&lt;h2 id=&quot;c-reference&quot;&gt;C. Reference&lt;/h2&gt;
&lt;ol&gt;
  &lt;li&gt;&lt;a href=&quot;https://www.wikitechy.com/technology/how-to-root-and-install-twrp-recovery-on-xiaomi-mi4/&quot;&gt;TWRP fastboot&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://android.stackexchange.com/questions/53389/can-i-update-the-adb-shells-environment-variables&quot;&gt;ADB shell environment&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://android.stackexchange.com/questions/110927/how-to-mount-system-rewritable-or-read-only-rw-ro&quot;&gt;Mount /system RR&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://busybox.net/FAQ.html&quot;&gt;Busybox FAQ&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://cryptojedi.org/misc/nexuss-debian.shtml&quot;&gt;Debian on android&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://stackoverflow.com/questions/36451444/what-can-cause-a-socket-permission-denied-error&quot;&gt;Chroot on android&lt;/a&gt;&lt;/li&gt;
&lt;/ol&gt;
</description>
        <pubDate>Tue, 11 Sep 2018 00:00:00 +0700</pubDate>
        <link>https://blog.tracelog.in/technical/2018/09/11/Debian-on-android-shell.html</link>
        <guid isPermaLink="true">https://blog.tracelog.in/technical/2018/09/11/Debian-on-android-shell.html</guid>
        
        
        <category>technical</category>
        
      </item>
    
      <item>
        <title>Solving blaming game</title>
        <description>&lt;p&gt;&lt;strong&gt;Context&lt;/strong&gt;: stuck with problems, cannot find root cause, dunno and cannot understand and reproduce problem. Maybe feeling very tired for a long day, already taken 5 hours without any good executions. Maybe you don’t want to take responsibility for that.&lt;/p&gt;

&lt;p&gt;Introducing &lt;strong&gt;blaming&lt;/strong&gt;: the fine art of making others responsible for all the difficult things that happen to you.&lt;/p&gt;

&lt;p&gt;Nowadays, there are many many contexts &amp;amp; examples for blaming. I only want to wide the scope of this mindset, into SRE/Devops/Sysadmin fields. &lt;strong&gt;Why we blaming each others&lt;/strong&gt;, right or wrong? How can we fix/improve our mindset? &lt;strong&gt;How can we do better?&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;https://imgs.xkcd.com/comics/blame_2x.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;!--description--&gt;

&lt;p&gt;&lt;strong&gt;Table of Contents&lt;/strong&gt;&lt;/p&gt;
&lt;ul id=&quot;markdown-toc&quot;&gt;
  &lt;li&gt;&lt;a href=&quot;#real-life-example&quot; id=&quot;markdown-toc-real-life-example&quot;&gt;REAL LIFE EXAMPLE&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#reasons&quot; id=&quot;markdown-toc-reasons&quot;&gt;REASONS&lt;/a&gt;    &lt;ul&gt;
      &lt;li&gt;&lt;a href=&quot;#1-badness&quot; id=&quot;markdown-toc-1-badness&quot;&gt;1. Badness&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#2-defending&quot; id=&quot;markdown-toc-2-defending&quot;&gt;2. Defending&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#3-attacking&quot; id=&quot;markdown-toc-3-attacking&quot;&gt;3. Attacking&lt;/a&gt;&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#how-can-we-do-better&quot; id=&quot;markdown-toc-how-can-we-do-better&quot;&gt;HOW CAN WE DO BETTER?&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#reference&quot; id=&quot;markdown-toc-reference&quot;&gt;REFERENCE&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;real-life-example&quot;&gt;REAL LIFE EXAMPLE&lt;/h2&gt;

&lt;p&gt;Working on infras of someone else, working on services that not be built by ourself&lt;/p&gt;
&lt;ul&gt;
  &lt;li&gt;many legacy/unknown components&lt;/li&gt;
  &lt;li&gt;bad naming &amp;amp; coding conventions&lt;/li&gt;
  &lt;li&gt;lack of resource inventory, lack of useful documents.&lt;/li&gt;
  &lt;li&gt;found bad lines of code from developers, but must solve that shitty issue.&lt;/li&gt;
  &lt;li&gt;found unacceptable implementations, like opened all ports, all protocols to 0.0.0.0/0 &lt;strong&gt;(WTF)&lt;/strong&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;We start blaming others because they are bad, very bad&lt;/p&gt;
&lt;ul&gt;
  &lt;li&gt;Who did it?&lt;/li&gt;
  &lt;li&gt;Who’s the interviewer of that f*cker guy?&lt;/li&gt;
  &lt;li&gt;Hey man, you mad, go fuck yourself&lt;/li&gt;
  &lt;li&gt;Kick this man out please, I don’t want him in my team&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;reasons&quot;&gt;REASONS&lt;/h2&gt;

&lt;h4 id=&quot;1-badness&quot;&gt;1. Badness&lt;/h4&gt;

&lt;p&gt;We have a deep need for a sense of identity, and one way we do this is through social comparison, contrasting ourselves against others. 
If we can place ourselves higher in the pecking order of society then we can feel more important and have a greater sense of control.&lt;/p&gt;

&lt;p&gt;We seek a higher status than others. And blame is one of the tools we use to this end. If the other person is bad, then it seems &lt;strong&gt;we must be relatively good&lt;/strong&gt;.&lt;/p&gt;

&lt;h4 id=&quot;2-defending&quot;&gt;2. Defending&lt;/h4&gt;

&lt;p&gt;Maybe we’re &lt;strong&gt;scared&lt;/strong&gt; that we’re going to fall, because if our boss found this issue, we will be fire, or cannot have a higher salary. If we are not at fault, we &lt;strong&gt;blame to defend&lt;/strong&gt;. If we are at fault, then we &lt;strong&gt;blame to deflect&lt;/strong&gt;.&lt;/p&gt;

&lt;h4 id=&quot;3-attacking&quot;&gt;3. Attacking&lt;/h4&gt;

&lt;p&gt;Sometimes we know the reasons of issues are most from our side, but also come from their side.
We want to blame others less because we are moving attention away from ourselves and more because we &lt;strong&gt;specifically want to attack others&lt;/strong&gt;.&lt;/p&gt;

&lt;p&gt;A common reason to attack others is that we have some grudge against them, believing them to be bad or unworthy in some way and hence deserving punishment. Perhaps they have blamed us unfairly in past. Maybe they have hurt one of our friends. In any case, the opportunity to blame is used as a convenient method of subtle attack.&lt;/p&gt;

&lt;h2 id=&quot;how-can-we-do-better&quot;&gt;HOW CAN WE DO BETTER?&lt;/h2&gt;

&lt;p&gt;The keys aka solutions are &lt;strong&gt;NO BLAMING GAME&lt;/strong&gt; + &lt;strong&gt;JUST FIX THAT SHIT&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;You are good&lt;/strong&gt;, very good enough to know the bad (after taken 10 hours for finding rootcause)
Why don’t you sit down and plan to solve issues?
Calm down, breath, take a deep breath, let’s standup and take a coffee/tea cup, then relax your mind.&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;I recommended that you should &lt;strong&gt;switch&lt;/strong&gt; your mindset from blaming others to &lt;strong&gt;thinking that you have a change to make things better&lt;/strong&gt;. You are here to do that, you have a change to show off your experiences (devops god, hero of all things)&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;Figure out the problem&lt;/strong&gt;, &lt;strong&gt;plan a hotfix&lt;/strong&gt;, write-up &amp;amp; share &lt;strong&gt;step-by-step&lt;/strong&gt;, guide the fucker to understand and &lt;strong&gt;how to find root cause&lt;/strong&gt;.&lt;/p&gt;

&lt;p&gt;Even the f*cker is developer or other junior devops/sysdmin. They are bad, lack of knowledge.
Your job is inspecting, finding, &lt;strong&gt;solving&lt;/strong&gt;, validating, auditing, &lt;strong&gt;not pointing the figure elsewhere.&lt;/strong&gt;&lt;/p&gt;

&lt;hr /&gt;

&lt;p&gt;&lt;strong&gt;Disclamer and question&lt;/strong&gt;:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;If you cannot solve issues, it means you don’t have enough permission and knowledge to blame. RIGHT?&lt;/li&gt;
  &lt;li&gt;Blaming or not blaming, at the end, issues still right there. Blaming is not solving problems.&lt;/li&gt;
  &lt;li&gt;Why dont we sit down then try to fix that shit?&lt;/li&gt;
&lt;/ul&gt;

&lt;center&gt;&lt;img src=&quot;https://media.giphy.com/media/l4q8gzOgUQIy7Ml44/giphy.gif&quot; /&gt;&lt;/center&gt;

&lt;h2 id=&quot;reference&quot;&gt;REFERENCE&lt;/h2&gt;

&lt;ol&gt;
  &lt;li&gt;&lt;a href=&quot;http://changingminds.org/explanations/behaviors/blame/why_blame_others.htm&quot;&gt;http://changingminds.org/explanations/behaviors/blame/why_blame_others.htm&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://www.harleytherapy.co.uk/counselling/why-we-put-the-blame-on-others.htm&quot;&gt;https://www.harleytherapy.co.uk/counselling/why-we-put-the-blame-on-others.htm&lt;/a&gt;&lt;/li&gt;
&lt;/ol&gt;
</description>
        <pubDate>Sat, 25 Aug 2018 00:00:00 +0700</pubDate>
        <link>https://blog.tracelog.in/mindset/2018/08/25/Solving-blaming-game.html</link>
        <guid isPermaLink="true">https://blog.tracelog.in/mindset/2018/08/25/Solving-blaming-game.html</guid>
        
        
        <category>mindset</category>
        
      </item>
    
      <item>
        <title>Signal of linux</title>
        <description>&lt;h2 id=&quot;definition&quot;&gt;Definition:&lt;/h2&gt;

&lt;ul&gt;
  &lt;li&gt;System calls: communication chanel between user space program and kernel&lt;/li&gt;
  &lt;li&gt;Signals: a different channel, used for inter-process communication&lt;/li&gt;
  &lt;li&gt;Signals don’t carry any agrgument, they are self explanatory by their name&lt;/li&gt;
  &lt;li&gt;Some signals identified by a number, ie &lt;code class=&quot;highlighter-rouge&quot;&gt;SIGKILL&lt;/code&gt; (9)&lt;/li&gt;
  &lt;li&gt;That’s why we use &lt;code class=&quot;highlighter-rouge&quot;&gt;kill -9 &amp;lt;PID&amp;gt;&lt;/code&gt; to kill a process, because the kill command will send a defined signal to a process with a given identity &lt;code class=&quot;highlighter-rouge&quot;&gt;&amp;lt;PID&amp;gt;&lt;/code&gt;&lt;/li&gt;
  &lt;li&gt;when we run &lt;code class=&quot;highlighter-rouge&quot;&gt;kill -9 &amp;lt;PID&amp;gt;&lt;/code&gt; command, that process is not terminate itself, instead we’re telling that OS to stop running the program, no matter what the program is doing&lt;/li&gt;
&lt;/ul&gt;

&lt;!--description--&gt;

&lt;h2 id=&quot;some-useful-signals&quot;&gt;Some useful signals&lt;/h2&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;SIGINT&lt;/code&gt;: is the program interrupt signal. When user presses &lt;code class=&quot;highlighter-rouge&quot;&gt;CTRL+C&lt;/code&gt;, the terminal emulator sends this signal to the foreground process, it will terminate process, but it can be caught or ignored, it a graceful shutdown&lt;/li&gt;
  &lt;li&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;SIGTERM&lt;/code&gt;: is the termination signal. It used to cause process termination, this signal can be blocked, handled and ignored. It is the normal way to ask a process to terminate. The &lt;code class=&quot;highlighter-rouge&quot;&gt;kill&lt;/code&gt; command generates SIGTERM by default&lt;/li&gt;
  &lt;li&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;SIGKILL&lt;/code&gt;: is an immediate termination signal. It cannot be caught or ignored by the process, because when we send a &lt;code class=&quot;highlighter-rouge&quot;&gt;SIGKILL&lt;/code&gt; to a proces, we remove any chance for that process to do a tidy cleanup and shutdown.&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;For example, when a process does not die by using &lt;code class=&quot;highlighter-rouge&quot;&gt;Ctrl+C&lt;/code&gt; (SIGINT), we should use the command &lt;code class=&quot;highlighter-rouge&quot;&gt;kill -9&lt;/code&gt; on that process PID&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;
    &lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;SIGSTOP&lt;/code&gt;: is a process suspend signal, which tells the OS to stop/suspend a process. This signal cannot be caught or ignored. To resume the process, use SIGCONT signal to continue&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;Ctrl+C&lt;/code&gt;: The interrupt signal, sends &lt;code class=&quot;highlighter-rouge&quot;&gt;SIGINT&lt;/code&gt; to the job running in the foreground.&lt;/p&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;When a process is in a limbo state it is reasonable to send the process the &lt;code class=&quot;highlighter-rouge&quot;&gt;SIGKILL&lt;/code&gt; signal, which can be invoked by running the kill command with the -9 flag. Unlike &lt;code class=&quot;highlighter-rouge&quot;&gt;SIGTERM&lt;/code&gt; the &lt;code class=&quot;highlighter-rouge&quot;&gt;SIGKILL&lt;/code&gt; signal cannot be captured by the process and thus it cannot be ignored. The &lt;code class=&quot;highlighter-rouge&quot;&gt;SIGKILL&lt;/code&gt; signal is handled outside of the process completely, and is used to stop the process immediately. The problem with using &lt;code class=&quot;highlighter-rouge&quot;&gt;SIGKILL&lt;/code&gt; is that it does not allow an application to close its open files or database connections cleanly and over time could cause other issues; therefor it is generally better to reserve the &lt;code class=&quot;highlighter-rouge&quot;&gt;SIGKILL&lt;/code&gt; signal as a last resort.&lt;/p&gt;

&lt;h2 id=&quot;reference--read-more&quot;&gt;Reference &amp;amp; Read more&lt;/h2&gt;
&lt;ol&gt;
  &lt;li&gt;http://bencane.com/2014/04/01/understanding-the-kill-command-and-how-to-terminate-processes-in-linux/&lt;/li&gt;
  &lt;li&gt;https://en.wikipedia.org/wiki/Unix_signal&lt;/li&gt;
  &lt;li&gt;http://unix.stackexchange.com/questions/149741/why-is-sigint-not-propagated-to-child-process-when-sent-to-its-parent-process&lt;/li&gt;
  &lt;li&gt;http://askubuntu.com/questions/890591/why-doesnt-ctrl-c-kill-the-terminal-itself/890597&lt;/li&gt;
  &lt;li&gt;https://www.shellscript.sh/&lt;/li&gt;
  &lt;li&gt;https://www.win.tue.nl/~aeb/linux/lk/lk-5.html&lt;/li&gt;
  &lt;li&gt;https://lasr.cs.ucla.edu/vahab/resources/signals.html&lt;/li&gt;
  &lt;li&gt;http://www.linuxprogrammingblog.com/all-about-linux-signals?page=show&lt;/li&gt;
  &lt;li&gt;ftp://ftp.gnu.org/old-gnu/Manuals/glibc-2.2.3/html_chapter/libc_24.html&lt;/li&gt;
  &lt;li&gt;http://askubuntu.com/questions/184071/what-is-the-purpose-of-the-9-option-in-the-kill-command&lt;/li&gt;
  &lt;li&gt;https://www.digitalocean.com/community/tutorials/how-to-use-ps-kill-and-nice-to-manage-processes-in-linux&lt;/li&gt;
  &lt;li&gt;https://s905060.gitbooks.io/site-reliability-engineer-handbook/content/signals.html&lt;/li&gt;
  &lt;li&gt;http://bencane.com/2014/04/01/understanding-the-kill-command-and-how-to-terminate-processes-in-linux/&lt;/li&gt;
  &lt;li&gt;https://major.io/2010/03/18/sigterm-vs-sigkill/&lt;/li&gt;
&lt;/ol&gt;

</description>
        <pubDate>Wed, 15 Aug 2018 00:00:00 +0700</pubDate>
        <link>https://blog.tracelog.in/technical/2018/08/15/Signal-of-linux.html</link>
        <guid isPermaLink="true">https://blog.tracelog.in/technical/2018/08/15/Signal-of-linux.html</guid>
        
        
        <category>technical</category>
        
      </item>
    
  </channel>
</rss>
