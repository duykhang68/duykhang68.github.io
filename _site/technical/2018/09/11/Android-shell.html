<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title>Android shell</title>
    <meta name="description" content="Goal: init and config my old android phone to super tiny linux machine with interactive shell.Device: xiaomi Mi4W LTE, android 6.0.1 MMB29MSpecs: Quad-core m...">

    <!-- todo: include this into main.css -->

    <link rel="stylesheet" href=" /css/main.css ">
    <link rel="canonical" href="https://llnx.me/technical/2018/09/11/Android-shell.html">
    <link rel="alternate" type="application/rss+xml" title="Hieu's blog" href="https://llnx.me /feed.xml ">
    <script async defer src="https://buttons.github.io/buttons.js"></script>
    <script async src="https://llnx.me/assets/dist/fetch.min.js"></script>
    <script src="https://llnx.me/assets/dist/github-calendar.min.js"></script>
    <link rel="stylesheet" href="https://llnx.me/assets/dist/github-calendar.css" />
    <script src="https://llnx.me/assets/dist/pace.min.js"></script>
    <link href="https://llnx.me/assets/dist/pace.css" rel="stylesheet" />
    <!-- Fathom - simple website analytics - https://github.com/usefathom/fathom -->
    <script>
    (function(f, a, t, h, o, m){
	a[h]=a[h]||function(){
		(a[h].q=a[h].q||[]).push(arguments)
	};
	o=f.createElement('script'),
	m=f.getElementsByTagName('script')[0];
	o.async=1; o.src=t; o.id='fathom-script';
	m.parentNode.insertBefore(o,m)
    })(document, window, 'https://analytics.llnx.me/tracker.js', 'fathom');
    fathom('trackPageview');
    </script>
    <!-- / Fathom -->
</head>

  <body>
    <div class="page-content">
      <div class="container">
        <div class="three columns">
          <header class="site-header">

  <h1 class="logo"><a href="https://llnx.me/archive">Blog</a></h2>

  <div class="nav">
    
    <label for="menu-toggle" class="menu-icon">
        <!--div data-icon="ei-navicon"></div-->
        <svg viewBox="0 0 18 15">
          <path fill="#424242" d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.031C17.335,0,18,0.665,18,1.484L18,1.484z"/>
          <path fill="#424242" d="M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0c0-0.82,0.665-1.484,1.484-1.484 h15.031C17.335,6.031,18,6.696,18,7.516L18,7.516z"/>
          <path fill="#424242" d="M18,13.516C18,14.335,17.335,15,16.516,15H1.484C0.665,15,0,14.335,0,13.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.031C17.335,12.031,18,12.696,18,13.516L18,13.516z"/>
        </svg>
    </label>
    <input type="checkbox" id="menu-toggle">

    <div class="site-nav">
      <nav>
        <ul class="page-link">
          <li><a href="/">Home</a></li>
          <li><a href="/archive">Posts</a></li>
          <li><a href="/about">About</a></li>
          <li><a href="/friends">Friends</a></li>
          <li><a href="/hireme" style="color: #C25;font-size: 15px">Hire me ❯❯</a></span></li>
        </ul>
      </nav>
    </div>

  </div>
</header>

        </div>

        <div class="nine columns" style="z-index:100;">
          <div class="wrapper">
            <article class="post" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="article_header">
    <h1 class="special_title" itemprop="name headline">Android shell</h1>
    <time class="post_date">11 September 2018, Tuesday</time>
    <a class="post_date"> - 3 min read</a>
    <div class="issues" style="float: right">
      <a class="github-button" href="https://github.com/hieuhtr/Blog/issues" data-show-count="true" aria-label="Issue hieuhtr/Blog on GitHub">Explore</a>
    </div>
  </header>

  <div class="article-content" itemprop="articleBody">
    <p><strong>Goal</strong>: init and config my old android phone to super tiny linux machine with interactive shell.</p>
<div class="highlighter-rouge"><pre class="highlight"><code>Device: xiaomi Mi4W LTE, android 6.0.1 MMB29M
Specs: Quad-core max 2.5GHz, 3.00 GB memory, 16GB disk
Kernel: 3.4.0-gf4b741d-00690-gc8911e
Arch: armv7l
</code></pre>
</div>

<p><img src="/assets/img/android-shell.png" alt="" /></p>

<!--description-->

<h2 id="1-root-device">1. Root device</h2>

<p>Install <strong>adb</strong> and <strong>fastboot</strong> tools on mac</p>
<div class="highlighter-rouge"><pre class="highlight"><code>❯❯ brew cask install android-platform-tools

❯❯ adb --version
Android Debug Bridge version 1.0.40
Version 4797878
Installed as /usr/local/bin/adb

❯❯ fastboot --version
fastboot version 28.0.0-4797878
Installed as /usr/local/bin/fastboot

# Connect android to mac via usb 
# Verify device

❯❯ adb devices -l
List of devices attached
1f703708  device usb:336592896X product:cancro_wc_lte model:MI_4W device:cancro transport_id:13
</code></pre>
</div>

<p>Download then install <strong>twrp</strong> &amp; <strong>supersu</strong> on <strong>fastboot</strong></p>
<div class="highlighter-rouge"><pre class="highlight"><code>❯❯ wget internet.com/SR5-SuperSU-v2.82-SR5-20171001224502.zip ./
❯❯ wget internet.com/twrp-3.1.0-0-cancro.img ./

❯❯ adb push ./SR5-SuperSU-v2.82-SR5-20171001224502.zip /storage/self/primary/
SR5-SuperSU-v2.82-SR5-20171001224502.zip: 1 file pushed. 5.8 MB/s (6882992 bytes in 1.127s)

❯❯ adb reboot bootloader

❯❯ fastboot devices
1f703708	fastboot

❯❯ fastboot flash recovery ./twrp-3.1.0-0-cancro.img
Sending 'recovery' (13682 KB)                      OKAY [  0.464s]
Writing 'recovery'                                 OKAY [  0.305s]
Finished. Total time: 0.772s

❯❯ fastboot boot ./twrp-3.1.0-0-cancro.img
Downloading 'boot.img'                             OKAY [  0.432s]
booting                                            OKAY [  0.119s]
Finished. Total time: 0.560s

# Install SR5-SuperSU-v2.82-SR5-20171001224502.zip from TWRP
# Then reboot android
# Verify root on device

❯❯ adb shell
shell@cancro:/ $ su
root@cancro:/ #
</code></pre>
</div>

<h2 id="2-super-user-as-root">2. Super user as root</h2>

<p>Expand utilities with <strong>busybox</strong></p>

<div class="highlighter-rouge"><pre class="highlight"><code># Download &amp; install busybox

❯❯ wget https://busybox.net/downloads/binaries/1.28.1-defconfig-multiarch/busybox-armv7l
❯❯ adb push busybox-armv7l /data/local/tmp
busybox-armv7l: 1 file pushed. 3.8 MB/s (1079156 bytes in 0.270s)

❯❯ adb shell
shell@cancro:/ $ su
root@cancro:/ # mkdir /data/busybox
root@cancro:/ # move /data/local/tmp/busybox-armv7l /data/busybox
root@cancro:/ # cd /data/busybox
root@cancro:/data/busybox # ls -l
-rwxrwxrwx shell    shell     1079156 2018-02-15 20:47 busybox-armv7l
root@cancro:/data/busybox # ./busybox-armv7l --install ./

# Use ls of busybox 
# instead of current ls on android

root@cancro:/ # which ls
/system/bin/ls

root@cancro:/ # export PATH=/data/busybox:$PATH
root@cancro:/ # which ls
/data/busybox/ls
root@cancro:/ # which vi
/data/busybox/vi
</code></pre>
</div>

<p>Config environment variables</p>
<div class="highlighter-rouge"><pre class="highlight"><code># Choose one: (for security mount /system back to RO when finished)
# Mount system RW: mount -o rw,remount /system
# Mount system RO: mount -o ro,remount /system

root@cancro:/ # mount -o rw,remount /system
root@cancro:/ # vi /system/etc/mkshrc
...
export PATH=/data/busybox:$PATH
...
</code></pre>
</div>

<p>when facing with su command like this, we need reconfigure su</p>
<div class="highlighter-rouge"><pre class="highlight"><code># Issue with su command

shell@cancro:/ $ su
su: must be suid to work properly

# Resolve

root@cancro:/ # cp /su/bin/su /data/busybox/su
root@cancro:/ # ls -lh /su/bin/su
-rwxr-xr-x    1 0        0          73.6K Sep 11 13:49 /su/bin/su
root@cancro:/ # ls -lh /data/busybox/su
-rwx------    1 0        0          73.6K Sep 11 15:58 /data/busybox/su
</code></pre>
</div>

<h2 id="reference">Reference</h2>
<ol>
  <li><a href="https://www.wikitechy.com/technology/how-to-root-and-install-twrp-recovery-on-xiaomi-mi4/">TWRP fastboot</a></li>
  <li><a href="https://android.stackexchange.com/questions/53389/can-i-update-the-adb-shells-environment-variables">ADB shell environment</a></li>
  <li><a href="https://android.stackexchange.com/questions/110927/how-to-mount-system-rewritable-or-read-only-rw-ro">Mount /system RR</a></li>
  <li><a href="https://busybox.net/FAQ.html">Busybox FAQ</a></li>
</ol>

    <div id="gitment-container"></div>
  </div>

  <footer class="article-footer">

  <hr/>

  <section class="author">
  <div class="authorimage box" style="background: url(/assets/img/avatar.jpg)"></div>
  <div class="authorinfo box">
    <p class="bio" style="color: #222">
      I'm an engineer who likes learning, discussing, and solving problems. These days, I'm focusing on DevOps because I'd love to help ensure that services stay up and running, while continuing to ship software to customers rapidly. I also have a passion for building robust infrastructure at world scale. 
    </p>
    <a class="github-button" href="https://github.com/hieuhtr" data-size="large" data-show-count="true" aria-label="Follow @hieuhtr on GitHub">Follow @hieuhtr</a>
  </div>
  <hr style="border-top: 0px"></<hr>
  <div class="calendar"></div>
</section>
<script>
  GitHubCalendar(".calendar", "hieuhtr");
</script>

  </footer>

</article>

          </div>
        </div>
      </div>
    </div>
  </body>
</html>
